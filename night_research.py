import os
from openai import OpenAI
from datetime import datetime
from dotenv import load_dotenv

load_dotenv()
API_KEY = os.getenv("OPENAI_API_KEY")

print(API_KEY)

# 1. OpenAIクライアント初期化（APIキーは環境変数）
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# 2. プロンプト
prompt = """
あなたは「日本IT業界を専門に調査するプロのリサーチャー兼投資アナリスト」です。
感想ではなく、事実・構造・因果関係を重視して分析してください。

# 調査テーマ
現在の日本IT業界について、ニュース・産業構造・主要企業・リスクを踏まえ、
将来的な株式投資の判断材料となる分析レポートを作成してください。

# 制約条件（必ず守る）
- 推測は推測と明示する
- 過度に断定しない
- 投資助言ではなく「判断材料」を提示する
- 日本市場特有の事情を重視する
- 可能な限り、具体的な企業名も提示する
---

## 📰 最新ニュース分析
以下の観点で、直近1〜2週間のIT業界・関連経済ニュースを整理してください。
また、参照した記事の出典は必ず記載して下さい。

- 世界的に主要な技術トレンド（AI、クラウド、DX、半導体 等）
- 企業動向（投資、提携、業績）
- 政策・規制（政府方針、補助金、規制）
- 海外要因（米中、為替、地政学）
- 上記の4観点が日本のIT業界に与える影響

### 出力形式
- ニュース要約（箇条書き）
- それぞれが業界に与える影響

---

## フェーズ①：世界のIT業界の全体像（マクロ）
- 市場構造（どの分野が中核か）
- 成長分野・成熟分野
- 欧州・米国・中国の比較と各国市場特有の制約・強み

---

## フェーズ②：日本IT業界の全体像（マクロ）
- 市場構造（どの分野が中核か）
- 成長分野・成熟分野
- 日本市場特有の制約・強み

---

## フェーズ③：技術・ビジネス構造
- 欧州・米国・中国の主流技術トレンド
- 日本の主流技術トレンド
- 主要なビジネスモデル・収益モデル
- 収益モデルの特徴
- 海外IT企業との構造的な違い

---

## フェーズ④：主要プレイヤー分析
現在の日本のIT業界において重要性が高いと考えられる企業を、以下のタイプごとに【実在する具体的な企業名】を4社づつ挙げて分析してください。

### 1. 大手SIer

### 2. SaaS / プロダクト企業

### 3. IT&製造・通信系

### 4. 新興・スタートアップ

各タイプについて：
- 強み
- 懸念点
- 中長期のポジション

---

## フェーズ⑤：リスク・外部環境
- 規制・政策リスク
- 人材・労働市場
- 技術の陳腐化
- マクロ経済・為替

---

## フェーズ⑥：投資観点での示唆（結論）
- 今後注視すべき分野
- 慎重に見るべきポイント
- 追加で深掘りすべきテーマ（次回調査候補）

---

## 出力形式（厳守）
- Markdown形式
- 見出し（## / ###）を明確に
- 箇条書きを多用
- 冗長な前置き・まとめは不要
"""

# 3. API呼び出し（1回だけ）
response = client.chat.completions.create(
model="gpt-4.1-mini",
messages=[
{"role": "system", "content": "あなたは優秀な業界アナリストです。"},
{"role": "user", "content": prompt}
],
)

result_text = response.choices[0].message.content

# 4. 出力ファイル名（日付付き）
today = datetime.now().strftime("%Y-%m-%d")
output_path = f"output/japan_it_report_{today}.md"

# 5. ファイル保存
os.makedirs("output", exist_ok=True)
with open(output_path, "w", encoding="utf-8") as f:
    f.write("# IT業界（日本版） 簡易レポート\n\n")
    f.write(result_text)

print(f"レポート生成完了: {output_path}")

